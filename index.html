<!DOCTYPE html>
<html>
<head>
    <title>Share Your Location</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; text-align: center; padding: 20px; background: #f0f2f5; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        button { background: #2575fc; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 25px; cursor: pointer; margin: 20px 0; width: 100%; }
        .location { background: #e8f4ff; padding: 15px; margin: 15px 0; border-radius: 10px; text-align: left; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .links { margin: 20px 0; }
        .links a { display: block; margin: 10px 0; padding: 10px; background: #2575fc; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìç Share Your Location</h1>
        <p>Click the button below to share your current location. It will be visible on the map view.</p>
        
        <button onclick="shareLocation()">üìç Share My Location</button>
        
        <div id="status"></div>
        <div id="locationInfo" style="display: none;"></div>
        
        <div class="links">
            <a href="/map" target="_blank">üó∫Ô∏è View All Locations Map</a>
            <a href="/api/locations" target="_blank">üìä View Raw Data</a>
        </div>
    </div>

    <script>
        async function shareLocation() {
            const status = document.getElementById('status');
            status.innerHTML = '<div class="success">üîÑ Getting your location...</div>';
            
            if (!navigator.geolocation) {
                status.innerHTML = '<div class="error">‚ùå Geolocation is not supported by your browser</div>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const locationData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent
                    };

                    try {
                        const response = await fetch('/api/locations', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(locationData)
                        });

                        const result = await response.json();
                        
                        if (result.success) {
                            status.innerHTML = '<div class="success">‚úÖ Location shared successfully!</div>';
                            document.getElementById('locationInfo').innerHTML = `
                                <div class="location">
                                    <strong>Your Location:</strong><br>
                                    üìç ${locationData.latitude.toFixed(6)}, ${locationData.longitude.toFixed(6)}<br>
                                    üéØ Accuracy: ${Math.round(locationData.accuracy)} meters<br>
                                    üïí Time: ${new Date().toLocaleString()}<br>
                                    <a href="https://maps.google.com?q=${locationData.latitude},${locationData.longitude}" target="_blank">
                                        View on Google Maps
                                    </a>
                                </div>
                            `;
                            document.getElementById('locationInfo').style.display = 'block';
                        } else {
                            status.innerHTML = `<div class="error">‚ùå Error: ${result.message}</div>`;
                        }
                    } catch (error) {
                        status.innerHTML = `<div class="error">‚ùå Network error: ${error.message}</div>`;
                    }
                },
                (error) => {
                    let message = 'Unknown error occurred';
                    switch(error.code) {
                        case error.PERMISSION_DENIED: message = 'Location access denied'; break;
                        case error.POSITION_UNAVAILABLE: message = 'Location unavailable'; break;
                        case error.TIMEOUT: message = 'Location request timeout'; break;
                    }
                    status.innerHTML = `<div class="error">‚ùå ${message}</div>`;
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }
    </script>
</body>
</html>